% -----------------------------------------------------------------
% This file contains common configurations and styling used in
% several of my LaTeX documents to avoid cluttering the preamble
% of each file.
%
% Write \input{../preamble.tex} after the \documentclass[]{} 
% command to import this file.
% -----------------------------------------------------------------

% -----------------------------------------------------------------
% The next section is where all imported packages are defined.
% New commands, environments, and redefinitions are also included
% here.
% -----------------------------------------------------------------
\usepackage[margin=1.1in]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{spalign}
\usepackage{multirow}
\usepackage{afterpage}
\usepackage{graphicx}
\usepackage[format=plain, textfont=it]{caption}

\usepackage{amsmath, amssymb, amsthm, commath}
\usepackage{systeme}
\usepackage{physics}
\usepackage{cancel}
\usepackage{siunitx}
\usepackage{listings}
\usepackage{bm}

\usepackage{mathpazo}
\usepackage{domitian}
\let\oldstylenums\oldstyle

\renewcommand{\footrulewidth}{0pt}
\renewcommand{\labelitemi}{$\bullet$}

\setlength\parskip{0.3em}

% Put x\to\infty below \lim
\let\svlim\lim\def\lim{\svlim\limits}

\let\implies\Rightarrow
\let\impliedby\Leftarrow
\let\iff\Leftrightarrow
\let\epsilon\varepsilon

\newcommand\rela{\ensuremath{\mathcal{R}}}

\newcommand\N{\ensuremath{\mathbb{N}}}
\newcommand\Z{\ensuremath{\mathbb{Z}}}
\newcommand\Q{\ensuremath{\mathbb{Q}}}
\newcommand\R{\ensuremath{\mathbb{R}}}
\newcommand\C{\ensuremath{\mathbb{C}}}
\renewcommand\O{\ensuremath{\emptyset}}

\DeclareMathOperator{\arcctan}{arcctan}
\DeclareMathOperator{\arctanh}{arctanh}
\DeclareMathOperator{\card}{card}
\DeclareMathOperator{\tq}{\, |\,}

\newcommand\hide[1]{}
\newcommand\hr{\noindent\rule[0.5ex]{\linewidth}{0.5pt}}

% Style to hide the header in the page where a new topic begins.
\fancypagestyle{noheaders}{%
    \renewcommand{\headrulewidth}{0pt}
    \fancyhead{}
    \fancyfoot{}
    \fancyfoot[C]{\thepage}}

% Style to display headers in most of the pages.
\fancypagestyle{withheaders}{%
    \fancyhead{}
    \fancyfoot{}
    \fancyhead[LO, RE]{\nouppercase\leftmark}
    \fancyfoot[C]{\thepage}}

% Default page style.
\pagestyle{withheaders}

% Format section, subsection, etc. titles.
\titleformat{\section}
{\normalfont\Huge\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}
{\normalfont\Large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}
{\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}
\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titleformat{\subparagraph}
{\normalfont\normalsize\bfseries}{\thesubparagraph}{1em}{}

% By default the {cases} environment let us display a system of 
% equations with a huge brace on the left side. For this reason,
% the following environments display a system of equations with
% the brace on the right, {rcases}, and on both sides, {lrcases},
% respectively.
\usepackage{empheq}
\renewenvironment{rcases}{\left.\begin{aligned}}{\end{aligned}\right\rbrace}
\newenvironment{lcases}{\left\lbrace\begin{aligned}}{\end{aligned}\right.}
\newenvironment{lrcases}{\left\lbrace\begin{aligned}}{\end{aligned}\right\rbrace}

%\newenvironment{lrcases}{%
%    \begin{empheq}[left=\empheqlbrace, right=\empheqrbrace]{align}
%}{\end{empheq}}

\newcommand\inputcprogram[2]{%
    \lstinputlisting[language=C, caption=#2]{#1}
}

% Create an awesome title with the name of the course, its code, group,
% year and semester.
% Usage: \makenotestitle{coursename}{year}{semester}, where 'coursename'
% is formatted as: name (code group) notes
% Example: \makenotestitle{Linear Algebra (ALG 119) notes}{First year}{First semester}
\newcommand\makenotestitle[3]{%
\begin{center}
    \thispagestyle{noheaders}
    \Huge\textbf{#1}
    \vskip0.5cm
    \Large Bachelor in Computer Science and Engineering
    \vskip0.5cm
    \large #2 - #3
    \vskip1.5cm
\end{center}}

% Begin a new topic. The first argument is the name of the topic with
% linebreaks, in other words, it's the name that will be display at the
% beginning of the section. The second argument is also the name of the
% topic but this time without linebreaks; it's the one that will be used
% to display the name of the topic in the table of contents and the 
% headers.
%
% Note: This fix should be improved in the future but for now works
% fine, and no other solution comes to my mind.
\newcommand\topic[2]{%
    \newpage
    \thispagestyle{noheaders}
    \section[#2]{#1}}

\newenvironment{paragraf}[1][]{%
    \noindent\textbf{#1.}~
}{\medskip}

% -----------------------------------------------------------------
% The following section contains different definitions for
% theorem, definitions, etc. and their corresponding styles.
% Also there's included the Spanish equivalents for the 
% definitions below.
% -----------------------------------------------------------------
\makeatother
\usepackage[framemethod=TikZ]{mdframed}
\mdfsetup{skipabove=1em, skipbelow=0em}

% Define 'theorem' and 'corollary' counters. Theorems, definitions, propositions,
% and lemmas use the same counter, 'theorem'. Corollaries use the 'corollary'
% counter, which is a "subcounter" linked to the 'theorem' counter. The 'prop'
% counter is used to keep track of properties.
\newcounter{theorem}[section]\setcounter{theorem}{0}
\renewcommand{\thetheorem}{\arabic{section}.\arabic{theorem}}
\newcounter{corollary}[theorem]\setcounter{corollary}{0}
\renewcommand{\thecorollary}{\arabic{section}.\arabic{theorem}.\arabic{corollary}}
\newcounter{example}[section]\setcounter{example}{0}
\renewcommand{\theexample}{\arabic{section}.\arabic{example}}
\newcounter{prop}[section]\setcounter{prop}{0}
\renewcommand{\theprop}{\arabic{section}.\arabic{prop}}
\newcounter{program}[section]\setcounter{program}{0}
\renewcommand{\theprogram}{\arabic{section}.\arabic{program}}

% {theorem} environment definition. Usage:
% \begin{theorem}[Cool theorem name]{reference}\end{theorem}
% Both arguments are optional. 
%
% Usage example:
% \begin{theorem}[Pythagoras' theorem]{thm:pythagoras}
% In a right triangle, the square of the hypotenuse is equal to the sum of the 
% squares of the catheti.
% \end{theorem}
%
% Bug: For some reason related to \ifstrempty, the first letter in the second 
% argument is being displayed separate from the rest of the text. The first
% argument works fine when given. This also happends in the {proof}
% environment so as for now the title of the theorem should be written
% manually.
\usepackage{ifthen}
\newenvironment{theorem}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    %\ifstrempty{#1}{%
    %    \begin{mdframed}\relax\textbf{Theorem~\thetheorem.}~\it{#2}
    %}{\begin{mdframed}\relax\textbf{Theorem~\thetheorem.}~(#1)~#2}

    %\ifstrempty{#1}{\begin{mdframed}\relax\textbf{Theorem~\thetheorem.}~\it}{\begin{mdframed}\relax\textbf{Theorem~\thetheorem.~(#1).}~\it}

    %\ifthenelse{\equal{#1}{}}{%
    %    \begin{mdframed}\relax\textbf{Theorem~\thetheorem.}~\it{#2}
    %}{\begin{mdframed}\relax\textbf{Theorem~\thetheorem.~(#1).}~\it{#2}}

    \begin{mdframed}\relax\textbf{Theorem~\thetheorem.~#1}~\it
    %\begin{mdframed}\relax\textbf{Theorem~\thetheorem.}~\it{#1}
}{\end{mdframed}}

% {definition} environment definition. Usage:
% \begin{definition} Something to define \end{definition}
\newenvironment{definition}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}[]\relax\textbf{Definition~\thetheorem.}~
}{\end{mdframed}}

% {proposition} environment definition. Usage:
% \begin{proposition} Some random proposition \end{proposition}
\newenvironment{proposition}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Proposition~\thetheorem.}~#1
}{\end{mdframed}}

% {lemma} environment definition. Usage:
% \begin{lemma} This lemma should help proving a theorem. \end{lemma}
\newenvironment{lemma}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Lemma~\thetheorem.}~#1
}{\end{mdframed}}

% {corollary} environment definition. Usage:
% \begin{corollary} This is a consequence of a theorem. \end{corollary}
\newenvironment{corollary}[1][]{%
    \refstepcounter{corollary}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Corollary~\thecorollary.}~#1
}{\end{mdframed}}

% {example} environment definition. Usage:
% \begin{example}{Example heading} This is how it's solved. \end{example}
\newenvironment{example}[1][]{%
    \refstepcounter{example}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Example~\theexample.~#1} \\ 
}{\end{mdframed}}

% {note} environment definition. Usage:
% \begin{note} \ldots \end{note}
\newenvironment{note}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\emph{Note.}~#1
}{\end{mdframed}}

% {remark} environment definition. Usage:
% \begin{remark} Remark something important. \end{remark}
\newenvironment{remark}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\emph{Remark.}~#1
}{\end{mdframed}}

% {proof} environment definition. Usage:
% \begin{proof}
%   Some theorem is being proved here.
% \end{proof}
% Note: The {proof} environment already exists in the 'amsthm' package. 
% For this reason, we should redefine it.
\renewenvironment{proof}{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\emph{Proof.}~
}{\qed\end{mdframed}}

% {prop} environment definition. Usage:
% \begin{prop} Sum of vectors is associative. \end{prop}
\newenvironment{prop}[1][]{%
    \refstepcounter{prop}\par\medskip
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Property~\theprop.}~
}{\end{mdframed}}

% {notation} environment definition.
\newenvironment{notation}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\emph{Notation.}~
}{\end{mdframed}}

% {program} environment definition.
% This environment should be used along with the \inputcprogram{} command.
\newenvironment{program}[1][]{%
    \refstepcounter{program}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax
    % \begin{mdframed}\relax\textbf{Program~\theprogram.}~#1 \\
}{\end{mdframed}}

% Spanish equivalent of the {theorem} environment.
\newenvironment{teorema}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Teorema~\thetheorem.}~\it
}{\end{mdframed}}

% Spanish environment for the {definition} environment.
\newenvironment{definicion}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Definición~\thetheorem.}~#1
}{\end{mdframed}}

% Spanish equivalent for the {proposition} environment.
\newenvironment{proposicion}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Proposición~\thetheorem.}~#1
}{\end{mdframed}}

% Spanish equivalent for the {lemma} environment.
\newenvironment{lema}[1][]{%
    \refstepcounter{theorem}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Lema~\thetheorem.}~#1
}{\end{mdframed}}

% Spanish equivalent for the {corollary} environment.
\newenvironment{corolario}[1][]{%
    \refstepcounter{corollary}
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Corolario~\thecorollary.}~#1
}{\end{mdframed}}

% Spanish equivalent for the {example} environment.
\newenvironment{ejemplo}[2][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\textbf{Ejemplo.~#1}
    #2
}{\end{mdframed}}

% Spanish equivalent for the {note} environment.
\newenvironment{nota}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\it{Nota.}~#1
}{\end{mdframed}}

% Spanish equivalent for the {remark} environment.
\newenvironment{observacion}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\emph{Observación.}~#1
}{\end{mdframed}}

% Spanish equivalent for the {proof} environment.
\newenvironment{demos}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\it{Demostración.}~#1 \\ \qed
}{\end{mdframed}}

% Spanish equivalent for the {prop} environment.
\newenvironment{propiedad}[1][]{%
    \refstepcounter{prop}\par\medskip
    \textbf{Propiedad~\theprop.}~#1
}{\medskip}

% Spanish equivalent for the {notation} environment.
\newenvironment{notacion}[1][]{%
    \mdfsetup{linecolor=black, linewidth=2pt, topline=false, bottomline=false, rightline=false}
    \begin{mdframed}\relax\emph{Notación.}~
}{\end{mdframed}}

% Alternative boxes for theorems, definitions, etc. If wanted to use,
% just remove the \hide{} command here and \hide the section above.
\hide{
\theoremstyle{plain}
\newmdtheoremenv[nobreak=true]{theorem}{Theorem}[section]

\theoremstyle{definition}
\newmdtheoremenv[nobreak=true]{definition}[theorem]{Definition}
\newmdtheoremenv[nobreak=true]{proposition}[theorem]{Proposition}
\newmdtheoremenv[nobreak=true]{corollary}{Corollary}[theorem]
\newmdtheoremenv[nobreak=true]{lemma}[theorem]{Lemma}
\newtheorem*{example}{Example}
\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newtheorem*{note}{Note}
}

% Fix some weird spacing on boxes created by {mdframed}.
% http://tex.stackexchange.com/questions/22119/how-can-i-change-the-spacing-before-theorems-with-amsthm
\makeatletter
\def\thm@space@setup{%
    \thm@preskip=\parskip \thm@postskip=0pt
}

% Cool box around equations. Usage: \begin{eqbox}{topspacing}[bottomspacing]
% Note: The 'bottomspacing' argument can be omitted.
\newlength\mytemplen
\newsavebox\mytempbox

\makeatletter
\newcommand\mybox{%
    \@ifnextchar[%]
        {\@mybox}%
        {\@mybox[0pt]}}

\def\@mybox[#1]{%
    \@ifnextchar[%]
        {\@@mybox[#1]}%
        {\@@mybox[#1][0pt]}}

\def\@@mybox[#1][#2]#3{
    \sbox\mytempbox{#3}%
    \mytemplen\ht\mytempbox
    \advance\mytemplen #1\relax
    \ht\mytempbox\mytemplen
    \mytemplen\dp\mytempbox
    \advance\mytemplen #2\relax
    \dp\mytempbox\mytemplen
    \fbox{\hspace{0.7em}\usebox{\mytempbox}\hspace{0.7em}}}

\newenvironment{eqbox}{\begin{empheq}[box=\mybox]}{\end{empheq}}

\makeatother





